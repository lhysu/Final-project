<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper
  PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
  "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="com.project.zerowasteshop.coupon.CouponMapper">

<update id="updateOK">
	update board set title=#{title}, content=#{content}, writer=#{writer},img_name=#{img_name},wdate=now()
	where num=#{num}
</update>

<delete id="deleteOK">
	delete from board where num=#{num}
</delete>

<select id="selectOne" resultType="com.project.zerowasteshop.coupon.CouponVO">
	select * from board where num =#{num} order by num desc
</select>

<select id="selectAll" resultType="com.project.zerowasteshop.coupon.CouponVO">
	select * from coupon order by coupon_code desc
</select>

<select id="selectAllPageBlock" resultType="com.project.zerowasteshop.coupon.CouponVO">
	select * from coupon order by coupon_code desc limit #{startRow}, #{pageBlock}
</select>

<select id="searchListPageBlockTitle" resultType="com.project.zerowasteshop.coupon.CouponVO">
	select * from board where title like #{searchWord} order by num desc limit #{startRow}, #{pageBlock}
</select>

<select id="searchListPageBlockContent" resultType="com.project.zerowasteshop.coupon.CouponVO">
	select * from board where content like #{searchWord} order by num desc limit #{startRow}, #{pageBlock}
</select>

<select id="getTotalRows" resultType="java.lang.Integer">
	select count(*) total_rows from coupon 
</select>

<select id="searchListTitle" resultType="com.project.zerowasteshop.coupon.CouponVO">
	select * from board where title like #{searchWord} order by num desc
</select>

<select id="getSearchTotalRowsTitle" resultType="java.lang.Integer">
	select count(*) total_rows from board where title like #{searchWord}
</select>

<select id="getSearchTotalRowsContent" resultType="java.lang.Integer">
	select count(*) total_rows from board where content like #{searchWord}
</select>

<select id="searchListContent" resultType="com.project.zerowasteshop.coupon.CouponVO">
	select * from board where content like #{searchWord} order by num desc
</select>

<!-- 쿠폰 코드 확인 -->
<select id="checkCouponCode" resultType="int">
	select count(*) from coupon where coupon_code = #{couponCode} and member_id IS NULL
</select>

<!-- 쿠폰 등록 -->
<update id="registerCoupon">
	update coupon set member_id = #{member_id} where coupon_code = #{couponCode}
</update>

<insert id="createCoupons">
	insert into coupon(coupon_code,member_id, coupon_name, use_sdate, use_edate,discount_rate,used)
	values(#{coupon_code},#{member_id},#{coupon_name},#{use_sdate},#{use_edate},#{discount_rate},#{used})
</insert>

</mapper>
