<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <title>구매 페이지</title>
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.7.1/jquery.min.js"></script>
    
    <!-- 카카오 주소 API 스크립트 -->
    <script src="https://t1.daumcdn.net/mapjsapi/bundle/postcode/prod/postcode.v2.js"></script>
    <script>
        $(function() {
            // 다음 주소 API를 사용하여 우편번호 찾기 기능 구현
            $('#findPostcode').on('click', function() {
                new daum.Postcode({
                    oncomplete: function(data) {
                        var roadAddr = data.roadAddress; // 도로명 주소
                        var jibunAddr = data.jibunAddress; // 지번 주소
                        var postCode = data.zonecode; // 우편번호

                        document.getElementById('postcode').value = postCode;
                        document.getElementById("address").value = roadAddr !== '' ? roadAddr : jibunAddr;

                        document.getElementById("address_detail").focus();  // 상세 주소에 포커스
                    }
                }).open();
            });
            
         	// 쿠폰 적용 버튼 클릭 시
	            $('#applyCouponBtn').on('click', function() {
	                alert("쿠폰이 적용되었습니다.");
	                $('#discount').text('1,000원');
	                $('#final_price').text('79,000원');
	            });

            // 포인트 적용 버튼 클릭 시
	            $('#applyPointsBtn').on('click', function() {
	                alert("포인트가 적용되었습니다.");
	                $('#discount').text('1,000원');
	                $('#final_price').text('79,000원');
	            });

            // 결제 완료 버튼 클릭 시
	            $('#orderForm').on('submit', function(event) {
	                event.preventDefault();  // 기본 폼 제출 방지
	
	                // 결제 처리 로직
	                alert("결제가 완료되었습니다.");
	
	                // 실제로는 여기서 서버로 결제 데이터를 전송해야 합니다.
	                // 예: $.ajax({...})를 통해 서버로 데이터 전송
	            });
        });
    </script>
</head>
<body>
    <div>
        <h1>주문/결제</h1>

        <form id="orderForm" action="/order/pay" method="post">
            <div>
	            <h2>배송지 정보</h2>
	            
	            <label for="name">주문자 명:</label>
	            [[${name}]]<input type="hidden" th:value="${name}">
	            
	            <br>
	            
	            <label for="tel">연락처 : </label>
	            [[${tel}]]<input type="hidden" th:value="${tel}">
	            
	            <br>
	            
	            <label for="postcode">우편번호</label>
	            <input type="text" id="postcode" name="postcode"  th:value="${postcode}" placeholder="우편번호" readonly />
	            <button type="button" id="findPostcode">우편번호 찾기</button>
	            
	            <br>
	            
	            <label for="address">주소</label>
	            <input type="text" id="address" name="address" th:value="${address}" placeholder="주소" readonly />
	            
	            <br>
	            
	            <label for="address_detail">상세주소</label>
	            <input type="text" id="address_detail" name="address_detail" th:value="${address_detail}" placeholder="상세주소" />
	            
	            <br>
	            
	            <label for="delivery_memo">배송 요청 사항</label>
	            <select id="delivery_memo" name="delivery_memo">
	            	<option value="문 앞에 두고 가세요">문 앞에 두고 가세요</option>
                	<option value="배송 전에 미리 연락 주세요">배송 전에 미리 연락 주세요</option>
                	<option value="직접 수령할게요">직접 수령할게요</option>
                	<option value="경비실에 맡겨 주세요">경비실에 맡겨 주세요</option>
                	<option value="요청사항 없음">요청사항 없음</option>       
	            </select>	            	            
            </div>
            
            <div>
            <h2>주문 상품</h2>
	            <table>
	            <tr>
	                <td><img th:src="${product_img}" alt="Product Image" width="50"></td>
	                <td>[[${product_name}]]</td>
	                <td>[[${price}]]원</td>
	            </tr>
	        	</table>
            </div>
            
            <h3>재사용 포장재 반납 신청</h3>
        	<input type="checkbox" id="reusing" name="resuing"> 반납 신청

	        <h3>쿠폰 적용</h3>
	        <select id="couponSelect" name="coupon">
                <option value="">쿠폰 선택</option>
                <!-- 서버에서 전달된 쿠폰 목록을 드롭다운으로 표시 -->
                <option th:each="coupon : ${couponList}" 
                        th:value="${coupon.coupon_code}" 
                        th:text="${coupon.coupon_name + ' - ' + coupon.discount_rate + '% 할인'}">
                </option>
            </select>
	        <button type="button" id="applyCouponBtn">사용하기</button>
	
	        <h3>포인트 적용</h3>
	        <input type="text" id="points" name="points" placeholder="1000p">
	        <button type="button" id="applyPointsBtn">사용하기</button>
            
            <div class="order-summary">
            <p>총 상품 금액: <span id="total_price">80,000원</span></p>
            <p>총 할인 금액: <span id="discount">1,000원</span></p>
            <p>배송비: <span id="shipping_fee">0원</span></p>
            <p class="total-price">최종 결제 금액: <span id="final_price">79,000원</span></p>
        	</div>
            
             
            <button type="submit">결제 완료</button>
        </form>
    </div>
</body>
</html>